<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<!-- 
 * UniTime 3.1 (University Timetabling Application)
 * Copyright (C) 2008, UniTime LLC
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 -->

<hibernate-mapping package="org.unitime.timetable.model">
	<class
		name="Location"
		abstract="true">
		
 		<cache include="non-lazy" usage="nonstrict-read-write"/>

        <id
            name="uniqueId"
            column="UNIQUEID"
            type="java.lang.Long"
        >
            <generator class="org.unitime.commons.hibernate.id.UniqueIdGenerator">
                <param name="sequence">Room_seq</param>
            </generator>
        </id>
        
		<property
			name="permanentId"
			column="PERMANENT_ID"
			type="java.lang.Long"
			not-null="true"
			length="20"
		/>			
					
		<property
			name="capacity"
			column="CAPACITY"
			type="java.lang.Integer"
			not-null="true"
			length="6"
		/>
		
		<property
			name="coordinateX"
			column="COORDINATE_X"
			type="java.lang.Integer"
			not-null="true"
			length="5"
		/>
		
		<property
			name="coordinateY"
			column="COORDINATE_Y"
			type="java.lang.Integer"
			not-null="true"
			length="5"
		/>
		
		<property
			name="ignoreTooFar"
			column="IGNORE_TOO_FAR"
			type="java.lang.Boolean"
			not-null="true"
		/>
		
		<property
			name="ignoreRoomCheck"
			column="IGNORE_ROOM_CHECK"
			type="java.lang.Boolean"
			not-null="true"
		/>

		<set name="features"
			table="ROOM_JOIN_ROOM_FEATURE" >
	 		<cache include="non-lazy" usage="read-write"/>
			<key column="ROOM_ID"/>			
			<many-to-many 
				class="RoomFeature" 
				column="FEATURE_ID" 
				foreign-key="FK_ROOM_FEATURE"/>
		</set>	
		
		<property
			name="managerIds"
			column="MANAGER_IDS"
			type="java.lang.String"
			not-null="false"
			length="200"
		/>
			
		<property
			name="pattern"
			column="PATTERN"
			type="java.lang.String"
			not-null="false"
			length="350"
		/>
			 
		<property
			name="examType"
			column="EXAM_TYPE"
			type="java.lang.Integer"
			length="10"
			not-null="false"
		/>

		<property
			name="examCapacity"
			column="EXAM_CAPACITY"
			type="java.lang.Integer"
			not-null="false"
			length="10"
		/>

		<set
			name="examPreferences"
			inverse="true"
			lazy="true"
			cascade="all"
			table="EXAM_LOCATION_PREF"
			>
	 		<cache include="non-lazy" usage="nonstrict-read-write"/>
			<key column="LOCATION_ID"/>
			<one-to-many class="org.unitime.timetable.model.ExamLocationPref" />
		</set>	

		<property
			name="displayName"
			column="DISPLAY_NAME"
			type="java.lang.String"
			not-null="false"
			length="100"
		/>

		<many-to-one 
			name="session" 
			class="Session" 
			column="SESSION_ID" 
			foreign-key="FK_ROOM_SESSION"
			 />
			
		<set
			name="assignments"
			inverse="true"
			table="ASSIGNED_ROOMS"
			>
	 		<cache include="non-lazy" usage="nonstrict-read-write"/>
			<key column="ROOM_ID"/>
			<many-to-many 
				class="Assignment"
				column="ASSIGNMENT_ID"
				foreign-key="FK_ROOM_ASSIGNMENT"
			/>
		</set>
				
        <set name="roomGroups"
			table="ROOM_GROUP_ROOM">
	 		<cache include="non-lazy" usage="read-write"/>	 		
			<key column="ROOM_ID"/>			
			<many-to-many 
				class="RoomGroup" 
				column="ROOM_GROUP_ID" 
				foreign-key="FK_ROOM_GROUP"/>
		</set>	

		<set
			name="roomDepts"
			inverse="true"
			lazy="true"
			cascade="all"
			table="ROOM_DEPT" 
			>
	 		<cache include="non-lazy" usage="nonstrict-read-write"/>
			<key column="ROOM_ID"/>
			<one-to-many class="org.unitime.timetable.model.RoomDept" />
		</set>		

		<union-subclass
			 	name="Room"
			 	table="ROOM"
			 	abstract="false"
			 	>
			<property name="buildingAbbv"
				type="java.lang.String"
				formula=" (select b.abbreviation from %SCHEMA%.building b where b.uniqueid = building_Id) "
				/>
		
			<property
				name="roomNumber"
				column="ROOM_NUMBER"
				type="java.lang.String"
				not-null="true"
				length="10"
			/>
			
			<property
				name="externalUniqueId"
				column="EXTERNAL_UID"
				type="java.lang.String"
				not-null="false"
				length="40"
			/>
		
			<many-to-one 
				name="roomType" 
				class="RoomType" 
				column="ROOM_TYPE" 
				foreign-key="FK_ROOM_TYPE"
				not-null="true"
				/>
				
			<property
				name="classification"
				column="CLASSIFICATION"
				type="java.lang.String"
				not-null="false"
				length="20"
			/>
		
			<many-to-one 
				name="building" 
				class="Building" 
				column="BUILDING_ID" 
				foreign-key="FK_ROOM_BUILDING"
				/>
		</union-subclass>	
		<union-subclass
			 	name="NonUniversityLocation"
			 	table="NON_UNIVERSITY_LOCATION"
			 	abstract="false"
			 	>
			 					
			<property
				name="name"
				column="NAME"
				type="java.lang.String"
				not-null="true"
				length="20"
			/>
			
			<many-to-one 
				name="roomType" 
				class="RoomType" 
				column="ROOM_TYPE" 
				foreign-key="FK_NON_UNIVERSITY_LOCATION_TYPE"
				not-null="true"
				/>
		</union-subclass>	
	
	</class>	
	
	<class
		name="ExamLocationPref"
		table="EXAM_LOCATION_PREF"
		>

 		<cache include="non-lazy" usage="read-write"/>

		<id 
            name="uniqueId"
            column="UNIQUEID" 
            type="java.lang.Long">            
            <generator class="org.unitime.commons.hibernate.id.UniqueIdGenerator">
				<param name="sequence">PREF_SEQ</param>
			</generator>
            
        </id>
        
		<many-to-one name="location"
			class="Location"
			column="LOCATION_ID"
			not-null="true" />

		<many-to-one name="prefLevel"
			class="PreferenceLevel"
			column="PREF_LEVEL_ID"
			not-null="true"
			foreign-key="FK_EXAM_LOCATION_PREF_PREF" />
			
		<many-to-one name="examPeriod"
			class="ExamPeriod"
			column="PERIOD_ID"
		 	not-null="true"
		 	foreign-key="FK_EXAM_LOCATION_PREF_PERIOD" />

	</class>		
</hibernate-mapping>
